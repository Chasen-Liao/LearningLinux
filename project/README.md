# 期末课设

## DDL: 12.24

#### 项目名称
SimpleChat_C/S：基于 C/S 架构的多人聊天程序

#### 项目描述
本项目是一个支持多用户同时在线的聊天系统，采用 C/S 架构，服务端通过多路 I/O 复用（select/poll/epoll）处理高并发连接，客户端支持注册、公共聊天、私聊、查看在线用户列表等功能，并将聊天记录写入日志文件。项目重点考察 Socket 网络编程、自定义通信协议、多线程/多进程模型及错误处理能力。

---

#### 功能需求
1. **多客户端支持**：服务器可同时处理多个客户端连接
2. **多路 I/O 复用**：使用 epoll 实现高效率的多路复用（兼容 select/poll 可选）
3. **核心功能**：
    - 用户注册（唯一用户名）
    - 公共聊天（消息广播给所有在线用户）
    - 私聊（定向发送消息给指定用户）
    - 在线用户列表显示
4. **日志记录**：聊天记录实时写入日志文件（如 `chat.log`）
5. **可选扩展**：管理员命令（`/kick username` 踢人、`/online` 查看在线用户）

---

#### 技术栈
- **网络通信**：TCP Socket 编程（长连接）
- **并发模型**：多线程（服务端使用线程池处理客户端请求）
- **I/O 复用**：epoll（高效事件驱动）
- **通信协议**：自定义包格式（包头 + 数据体，包含消息类型、长度、内容）
- **错误处理**：超时检测、异常连接断开重连机制

---

#### 项目结构
```
chat/
├── server/          # 服务端源码
│   ├── server.c     # 服务端主程序（初始化、监听、客户端管理）
│   ├── epoll.c      # epoll 多路复用实现
│   └── protocol.c   # 通信协议封装（打包/解包）
├── client/          # 客户端源码
│   └── client.c     # 客户端主程序（用户交互、消息收发）
├── include/         # 头文件
│   └── protocol.h   # 自定义通信协议定义（消息类型、包结构）
└── Makefile         # 编译脚本（make server / make client）
```

---

#### 安装与运行
1. **编译**：
```bash
# 编译服务端
make server
# 编译客户端
make client
```

2. **运行**：
```bash
# 启动服务端（默认端口：8888）
./server/server

# 启动客户端（连接本地服务端）
./client/client localhost 8888
```

3. **操作流程**：
- 客户端启动后输入用户名注册/登录
- 输入消息按回车发送公共聊天，或使用 `@username 消息` 进行私聊
- 输入 `/online` 查看在线用户列表（需实现可选功能）

---

#### 核心文件说明
| 文件          | 职责                                                                 |
|---------------|----------------------------------------------------------------------|
| `protocol.h`  | 定义消息类型（REGISTER, CHAT, PRIVATE, ONLINE_LIST等）、包结构（`struct MsgPack`） |
| `server.c`    | 服务端主逻辑：socket 初始化、客户端连接处理、消息路由（广播/私发）      |
| `epoll.c`     | 基于 epoll 的事件监听与分发（处理读/写事件、超时检测）                  |
| `client.c`    | 客户端逻辑：用户输入处理、消息发送、服务端消息接收与显示                |

---

#### 可选功能扩展
- **管理员命令**：
  - `/kick username`：服务端识别该指令，调用 `close(fd)` 断开对应客户端连接
  - `/online`：服务端返回当前在线用户列表，客户端解析后显示
- **日志记录**：服务端每次接收/发送消息时，将 `[时间] [用户] [消息内容]` 写入 `chat.log`

> LOG
> 12/4: 初步启动项目
