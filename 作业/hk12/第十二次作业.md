## 1. 问答题

### 1.1. 进程与线程的区别是什么？编程时如何选择？

### 1.2. 什么是同步和互斥？线程间有哪些同步互斥方式？

### 1.3. 什么是死锁？

### 1.4. 假设n个并发进程，共享m个共享资源，每个进程（线程）最多申请1个资源，信号量sem的取值范围是什么？

### 1.5. 信号量S的初值是1，进程对信号量S进行5次P操作、2次V操作后现在信号量S的值是多少？与信号量S相关的处于阻塞状态的进程（线程）有几个？

## 2. 编程题

### 2.1. 编写一个程序，写方式打开文件a.txt，开启四个线程，每个线程将自己的线程ID向文件中写入5遍，要求必须按顺序循环写入。如：abcdabcdabcdabcdabcd。

### 2.2. 如下有一个整型全局变量，编写双线程程序，一个线程递增该变量，另一个线程打印该变量，要保证按变量值递增顺序打印到屏幕，不重复，不跳跃。

`int NN = 0;`

打印效果：

```
NN=1
NN=2
…
```

### 2.3. 编写一个程序，创建三个线程，第一个线程屏幕打印0～9十个数字，第二个线程紧接着打印a~z二十六个小写字母，第三个线程最后再打印A～Z二十六个大写字母。

### 2.4. 下面的C程序homework4a.c，采用双线程搜索素数，主函数通过命令行参数接收最大搜索的整数，生成两个线程进行搜索。由于没有采用互斥算法，所以运行时有一些素数会被重复搜索（两个线程都搜索到），请采用互斥量修改代码，使搜索结果不重复。

```c
//homework4a.c
//双线程搜索素数，最简单搜索算法

#include <pthread.h> 
#include <stdio.h>
#include <stdlib.h> //atoi()

int m=2; //搜索到哪一个整数

void *search(void *); //定义线程函数

int main(int argc, char **argv)
{
        int n;
        pthread_t tid1, tid2;

        if(argc!=2) {
                printf("usage: ./home4a <n>\n");
                return 1;
        }
        n = atoi(argv[1]); //最大搜索整数，从main参数获得
        if (n==0){
                printf("error: not a integer\n");
                return 1;
        }
        pthread_create(&tid1, NULL, search, (void *)&n);
        pthread_create(&tid2, NULL, search, (void *)&n);
        pthread_join(tid1, NULL);
        pthread_join(tid2, NULL);
        return 0;
}

void *search(void *arg)
{
        int N = *(int *)arg;
        int flag = 1;
        pthread_t mytid = pthread_self();

        while(m<=N) {
                flag = 1;
                for(int j=2; j<=m/2; j++)
                        if( m%j==0 ) {
                                flag = 0;
                                break;
                        }
                if( flag==1)
                        printf("Thread %lu find: %d\n", mytid,  m);
                m++;
        }
        return (void *)NULL;
}
```

### 2.5. 一堆数字卡片，从1到100。甲乙两人分拣卡片，按顺序分拣，每12张一打，甲负责按顺序挑出卡片，乙负责将12张卡片打包，最后不足12张打一个包。请采用双线程和条件变量、互斥量程序模拟以上过程。

模拟提示：
1. 甲乙两个线程；
1. 甲线程按顺序打印数字，每到12倍数通知（条件变量）乙线程；
1. 乙线程接到通知就打印相应的12倍数的数字；
1. 输出样例：

```
甲挑出：1
甲挑出：2
甲挑出：3
甲挑出：4
甲挑出：5
甲挑出：6
甲挑出：7
甲挑出：8
甲挑出：9
甲挑出：10
甲挑出：11
甲挑出：12
乙打包：1～12
…
```

### 2.6. 编写一个倒计时软件，主函数接收键盘输入的倒计时任务名（字符串）和倒计时时间（秒），创建线程将倒计时过程打印到屏幕，程序可以多次输入倒计时任务和时间。

例如：

```
输入倒计时任务名:一等奖开奖
输入倒计时时间(s):60
<回车>
一等奖开奖剩余时间60秒
一等奖开奖剩余时间59秒
…
一等奖开奖
…
```

### 2.7. 编写程序，创建两个线程tid1、tid2：tid1计算1到n正整数数列的和，tid2计算1到n的平方和。主线程（主进程）获取n值，并最终输出两个计算结果，利用全局变量与tid1交换数据，利用函数pthread_create()、pthread_exit()的参数与线程tid2交换数据。

### 2.8. 分析以下程序可能输出结果有几种，并说明原因。

```c
//homework2.c

#include <stdio.h>
#include <pthread.h>

int mm = 0;

void *func(void *arg)
{       
        mm+=10; 
        return NULL;
}       

void main()
{       
        pthread_t tid1, tid2, tid3;

        pthread_create(&tid1, NULL, func, NULL);
        pthread_create(&tid2, NULL, func, NULL);
        pthread_create(&tid3, NULL, func, NULL);
        pthread_join(tid1, NULL);
        pthread_join(tid2, NULL);
        pthread_join(tid3, NULL);

        printf("mm = %d\n", mm);
}      
```

### 2.9. 分析以下程序可能输出结果有几种，并说明原因。

```c
//homework3.c

#include <stdio.h>
#include <pthread.h>

int mm = 0;
int nn = 0;

void *func1(void *arg)
{
        mm = nn + 10;
        return NULL;
}

void *func2(void *arg)
{
        nn = mm - 10;
        return NULL;
}

void main()
{
        pthread_t tid1, tid2;

        pthread_create(&tid1, NULL, func1, NULL);
        pthread_create(&tid2, NULL, func2, NULL);
        pthread_join(tid1, NULL);
        pthread_join(tid2, NULL);

        printf("mm=%d\tnn=%d\n", mm, nn);
}
```

### 2.10. 公司财务室有5名财务人员可以使用公司周转金帐号存取钱，每次存取钱以100元为单位，公司账号余额为0时不能透支，余额达到20万时不能再存入。请编写多线程仿真程序模拟周转金账户的资金变动，初始资金为10万。

提示：创建5个线程，每个线程循环存取钱，存钱或取钱动作是随机的，存取数额也是随机的，采用rand()随机数函数实现。

### 2.11. 某超市可容纳100人同时购物，入口处备有篮子，每个购物者可持一个篮子入内购物。在出口处结账，并归还篮子。出口和入口仅容纳一人通过。请用PV操作完成购物同步算法。

### 2.12. 某火车站有一车库，最多可以停三列火车，车站与外界以单轨相通，请用PV操作描述经过该车站的过程。

### 2.13. 四个线程A、B、C、D都要读一个共享文件a.txt，系统允许多个线程同时读文件但限制是进程A和进程C不能同时读文件，进程B和进程D也不能同时读文件。现用PV操作进行管理，使这四个线程同步读文件。

### 2.14. 在公共汽车上，司机的活动是：启动车辆，正常行驶，到站停车。售票员的活动是：关车门，售票，开车门。在公共汽车到站、停车、行驶的过程中，为保证乘客安全，必须在停车后开车门，在关车门后启动汽车，编程用信号量PV操作实现同步关系。
